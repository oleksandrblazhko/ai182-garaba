### V3.2 Прив'язка сеансу

|#|Опис|L1|L2|L3|CWE|NIST|
|----|----|----|----|----|----|----|
|3.2.1|Перевірте, чи програма генерує новий маркер сеансу для користувача аутентифікація.(C6)|✓|✓|✓|384|7.1|
|3.2.2|Переконайтеся, що маркери сеансу мають щонайменше 64 біти ентропії. (C6) |✓ |✓ |✓ |331 |7.1|
|3.2.3|Переконайтеся, що програма зберігає лише маркери сеансу у браузері за допомогою безпечні методи, такі як належним чином захищені файли cookie (див. розділ 3.4) або сховище сеансу HTML 5.|✓|✓|✓|539|7.1|
|3.2.4|Переконайтеся, що маркери сеансу генеруються за допомогою затверджених криптографічні алгоритми. (C6)||✓|✓|331|7.1|

## C6 Впровадити цифрову ідентифікацію

### Oпис
Цифрова ідентифікація — це унікальне представлення користувача (або іншого суб’єкта), коли він бере участь у онлайн-транзакції. Автентифікація — це процес підтвердження того, що особа чи організація є тими, за кого себе видають. Керування сеансами — це процес, за допомогою якого сервер підтримує стан автентифікації користувачів, щоб користувач міг продовжувати використовувати систему без повторної автентифікації. Спеціальна публікація NIST 800-63B: Рекомендації щодо цифрової ідентифікації (автентифікація та керування життєвим циклом) містить надійні вказівки щодо впровадження цифрової ідентифікації, автентифікації та керування сеансами.

Нижче наведено деякі рекомендації щодо безпечного впровадження.

### Рівні автентифікації
NIST 800-63b описує три рівні гарантії автентифікації, які називаються рівнем гарантії автентифікації (AAL). Рівень AAL 1 зарезервовано для програм із меншим ризиком, які не містять ідентифікаційної інформації чи інших особистих даних. На рівні 1 AAL потрібна лише однофакторна автентифікація, як правило, за допомогою пароля.

### Рівень 1: Паролі
Паролі дійсно дуже важливі. Нам потрібна політика, нам потрібно зберігати їх безпечно, нам потрібно іноді дозволяти користувачам скидати їх.

### Вимоги до пароля
Паролі повинні відповідати принаймні таким вимогам:

мати довжину не менше 8 символів, якщо також використовується багатофакторна автентифікація (MFA) та інші елементи керування. Якщо MFA неможливо, його слід збільшити принаймні до 10 символів
усі друковані символи ASCII, а також символ пробілу повинні бути прийнятними в запам’ятованих секретах
заохочуйте використання довгих паролів і парольних фраз
скасувати вимоги до складності, оскільки вони виявилися обмежено ефективними. Замість цього рекомендується прийняти MFA або пароль більшої довжини
переконайтеся, що використовувані паролі не є типовими паролями, які вже були розкриті під час попереднього зламу. Ви можете заблокувати 1000 чи 10 000 найпоширеніших паролів, які відповідають наведеним вище вимогам щодо довжини та містяться в зламаних списках паролів. Наступне посилання містить найпоширеніші паролі: https://github.com/danielmiessler/SecLists/tree/master/Passwords.
Впровадити безпечний механізм відновлення пароля
Як правило, програма має механізм, за допомогою якого користувач може отримати доступ до свого облікового запису, якщо він забуде свій пароль. Хороший робочий процес для функції відновлення пароля передбачає використання елементів багатофакторної автентифікації. Наприклад, він може задати таємне запитання – те, що вони знають, а потім надіслати згенерований маркер на пристрій – те, що їм належить.

Для отримання додаткової інформації перегляньте Forgot_Password_Cheat_Sheet і Choosing_and_Using_Security_Questions_Cheat_Sheet.

Впровадити безпечне зберігання паролів
Щоб забезпечити надійні засоби контролю автентифікації, програма повинна безпечно зберігати облікові дані користувача. Крім того, криптографічний контроль має бути на місці, щоб у разі зламу облікових даних (наприклад, пароля) зловмисник не мав негайного доступу до цієї інформації.

Приклад PHP для зберігання паролів

Нижче наведено приклад безпечного хешування пароля в PHP за допомогою функції password_hash() (доступної з версії 5.5.0), яка за замовчуванням використовує алгоритм bcrypt. У прикладі використовується робочий коефіцієнт 15.

<?php
  $вартість = 15;
  $password_hash = password_hash("секретний_пароль", PASSWORD_DEFAULT,["вартість" => $вартість]);
?>
Будь ласка, перегляньте шпаргалку зберігання паролів OWASP для отримання додаткової інформації.

### Рівень 2: багатофакторна автентифікація
Рівень 2 стандарту NIST 800-63b AAL зарезервовано для додатків із підвищеним ризиком, які містять «індивідуальну інформацію або іншу особисту інформацію, доступну в Інтернеті». На рівні 2 AAL потрібна багатофакторна автентифікація, включаючи OTP або інші форми багатофакторної реалізації.

Багатофакторна автентифікація (MFA) гарантує, що користувачі є тими, за кого себе видають, вимагаючи від них ідентифікації за допомогою комбінації:

Щось, що ви знаєте – пароль або PIN-код
Те, що у вас є – токен або телефон
Щось ви – біометрія, наприклад відбиток пальця
Використання паролів як єдиного фактора забезпечує слабку безпеку. Багатофакторні рішення забезпечують більш надійне рішення, вимагаючи від зловмисника отримати більше ніж один елемент для автентифікації за допомогою служби.

Варто зазначити, що біометрія, якщо вона використовується як єдиний фактор автентифікації, не вважається прийнятним секретом для цифрової автентифікації. Їх можна отримати в Інтернеті або сфотографувати когось за допомогою камери телефону (наприклад, зображення обличчя) з його відома або без нього, зняти з об’єктів, до яких хтось торкається (наприклад, приховані відбитки пальців), або зафіксувати зображення з високою роздільною здатністю (наприклад, райдужна оболонка ока). візерунки). Біометричні дані слід використовувати лише як частину багатофакторної автентифікації за допомогою фізичного автентифікатора (щось, що є у вас). Наприклад, доступ до пристрою з багатофакторним одноразовим паролем (OTP), який згенерує одноразовий пароль, який користувач вручну вводить для верифікатора.

### Рівень 3: Автентифікація на основі криптографії
NIST 800-63b Authentication Assurance Level 3 (AAL3) необхідний, коли вплив скомпрометованих систем може призвести до особистих збитків, значних фінансових втрат, завдати шкоди суспільним інтересам або спричинити цивільні чи кримінальні порушення. AAL3 вимагає автентифікації, яка «базується на доказі володіння ключем за допомогою криптографічного протоколу». Цей тип автентифікації використовується для досягнення найвищого рівня гарантії автентифікації. Зазвичай це робиться за допомогою апаратних криптографічних модулів.

### Керування сеансами
Після початкової успішної автентифікації користувача програма може вибрати відстеження та підтримку цього стану автентифікації протягом обмеженого проміжку часу. Це дозволить користувачеві продовжувати використовувати програму без повторної автентифікації для кожного запиту. Відстеження цього стану користувача називається керуванням сеансом.

Створення та закінчення сеансу
Стан користувача відстежується в сесії. Цей сеанс зазвичай зберігається на сервері для традиційного керування сеансами через Інтернет. Потім користувачеві надається ідентифікатор сеансу, щоб він міг визначити, який сеанс на стороні сервера містить правильні дані користувача. Клієнту потрібно лише підтримувати цей ідентифікатор сеансу, який також утримує конфіденційні дані сеансу на стороні сервера від клієнта.

Ось кілька елементів керування, які слід враховувати під час створення або впровадження рішень для керування сеансами:

Переконайтеся, що ідентифікатор сеансу є довгим, унікальним і випадковим.
Програма повинна створити новий сеанс або принаймні змінити ідентифікатор сеансу під час автентифікації та повторної автентифікації.
Додаток має реалізувати тайм-аут простою після періоду бездіяльності та абсолютний максимальний час життя для кожного сеансу, після якого користувачі повинні повторно автентифікуватися. Тривалість тайм-аутів має бути обернено пропорційною вартості захищених даних.
Додаткову інформацію див. у шпаргалці керування сеансом. Розділ 3 ASVS охоплює додаткові вимоги до керування сеансами.

### Файли cookie браузера
Файли cookie веб-переглядача є поширеним методом для веб-додатків для зберігання ідентифікаторів сеансів для веб-додатків, які реалізують стандартні методи керування сеансами. Ось деякі засоби захисту, які слід враховувати під час використання файлів cookie браузера.

Якщо файли cookie веб-переглядача використовуються як механізм для відстеження сеансу автентифікованого користувача, вони повинні бути доступні для мінімального набору доменів і шляхів і мають бути позначені як такі, що термін дії закінчується на момент або незабаром після закінчення терміну дії сеансу.
Позначку «захищений» слід встановити, щоб забезпечити передачу лише через захищений канал (TLS).
Слід встановити прапор HttpOnly, щоб запобігти доступу до файлів cookie через JavaScript.
Додавання атрибутів «samesite» до файлів cookie запобігає надсиланню файлів cookie з міжсайтовими запитами деякими сучасними браузерами та забезпечує захист від підробки міжсайтових запитів і атак витоку інформації.
Жетони
Серверні сеанси можуть обмежувати деякі форми автентифікації. «Сервіси без збереження стану» дозволяють керувати даними сеансу на стороні клієнта для підвищення продуктивності, тому сервер має менше навантаження на зберігання та перевірку сеансу користувача. Ці програми без стану генерують короткочасний маркер доступу, який можна використовувати для автентифікації запиту клієнта без надсилання облікових даних користувача після початкової автентифікації.

### JWT (веб-токени JSON)
Веб-токен JSON (JWT) — це відкритий стандарт (RFC 7519), який визначає компактний і самодостатній спосіб безпечної передачі інформації між сторонами як об’єкт JSON. Цю інформацію можна перевірити та довіряти їй, оскільки вона має цифровий підпис. Маркер JWT створюється під час автентифікації та перевіряється сервером (або серверами) перед будь-якою обробкою.

Однак JWT часто не зберігаються сервером після початкового створення. JWT зазвичай створюються, а потім передаються клієнту без жодного збереження на сервері. Цілісність токена підтримується за допомогою цифрових підписів, щоб пізніше сервер міг перевірити, що JWT все ще дійсний і його не змінено з моменту його створення.

Цей підхід є водночас без збереження стану та портативним, оскільки клієнтські та серверні технології можуть відрізнятися, але все ще взаємодіяти.

### Обережно

Цифрова ідентифікація, автентифікація та керування сеансами – це дуже великі теми. Ми торкнемося поверхні теми цифрової ідентичності. Переконайтеся, що ваші найздібніші інженери відповідають за підтримку складності більшості рішень ідентифікації.

## CWE-384: Фіксація сеансу
ID слабкого місця: 384
Абстракція: Компаунд
Структура: Композит
Перегляд персоналізованої інформації: Концептуальне операційне картографування, зручне повне

### Опис
Автентифікація користувача або встановлення нового сеансу користувача іншим способом без анулювання будь-якого існуючого ідентифікатора сеансу дає зловмиснику можливість викрасти автентифіковані сеанси.

### Композитні компоненти
Ім'я ID типу природи
Потрібна помилка підтвердження походження класу 346
Потрібен зовнішній контроль Base 472 передбачувано-незмінного веб-параметра
Потрібен ненавмисний проксі або посередник класу 441 («Збентежений заступник»)

### Розширений опис
Такий сценарій зазвичай спостерігається, коли:

Веб-програма автентифікує користувача без попереднього визнання існуючого сеансу недійсним, тим самим продовжуючи використовувати сеанс, який уже пов’язаний з користувачем.
Зловмисник може нав’язати користувачеві відомий ідентифікатор сеансу, щоб після автентифікації зловмисник отримав доступ до автентифікованого сеансу.
Додаток або контейнер використовує передбачувані ідентифікатори сеансу. У загальному випадку використання вразливостей фіксації сеансу зловмисник створює новий сеанс у веб-додатку та записує пов’язаний ідентифікатор сеансу. Потім зловмисник змушує жертву асоціюватися та, можливо, автентифікуватися з сервером, використовуючи цей ідентифікатор сеансу, надаючи зловмиснику доступ до облікового запису користувача через активний сеанс.
- Відносини
- Релевантно перегляду "Концепції дослідження" (CWE-1000)
Ім'я ID типу природи
ChildOf Class 610 Зовнішнє контрольоване посилання на ресурс в іншій сфері
- Відповідно до перегляду «Слабкі місця для спрощеного відображення опублікованих вразливостей» (CWE-1003)
- Релевантно перегляду "Архітектурні концепції" (CWE-1008)
- Режими вступу
- 
### Примітка фази
Архітектура та дизайн

### Реалізація
- Відповідні платформи

### Мови
Клас: не залежить від мови (поширеність не визначена)

### Загальні наслідки
Імовірність впливу масштабу

### Управління доступом
Технічний вплив: отримати привілеї або присвоїти ідентифікацію

## CWE-331: недостатня ентропія
ID слабкого місця: 331
#### Абстракція: База
#### Структура: проста
Перегляд персоналізованої інформації: Концептуальне операційне картографування, зручне повне

### Опис
У продукті використовується алгоритм або схема, які виробляють недостатню ентропію, залишаючи моделі або кластери значень, які мають більшу ймовірність, ніж інші.
### Відносини

#### Релевантно перегляду "Концепції дослідження" (CWE-1000)
Ім'я ID типу природи
ChildOf Class 330 Використання недостатньо випадкових значень
ParentOf Variant 332 Недостатня ентропія в PRNG
ParentOf Variant 333 Неправильна обробка недостатньої ентропії в TRNG

### Релевантно перегляду "Розробка ПЗ" (CWE-699)
Ім'я ID типу природи
MemberOf Категорія 1213 Проблеми з випадковими числами
MemberOf Категорія 310 Криптографічні проблеми
- Відповідно до перегляду «Слабкі місця для спрощеного відображення опублікованих вразливостей» (CWE-1003)
- Релевантно перегляду "Архітектурні концепції" (CWE-1008)
- Режими вступу
- 
### Примітка фази
Архітектура та дизайн

### РЕАЛІЗАЦІЯ Реалізації: ця слабкість виникає під час реалізації тактики архітектурної безпеки.
- Відповідні платформи

### Мови
Клас: не залежить від мови (поширеність не визначена)

### Загальні наслідки
Імовірність впливу масштабу

### Управління доступом
Інший

### Технічний вплив: захисний механізм обходу; Інший
Зловмисник може вгадати згенеровані випадкові числа та отримати несанкціонований доступ до системи, якщо випадкові числа використовуватимуться для автентифікації та авторизації.


## CWE-539: використання постійних файлів cookie, що містять конфіденційну інформацію
ID слабкого місця: 539
### Абстракція: Варіант
### Структура: проста
Перегляд персоналізованої інформації: Концептуальне операційне картографування, зручне повне

### Опис
Веб-програма використовує постійні файли cookie, але файли cookie містять конфіденційну інформацію.

### Розширений опис
Файли cookie — це невеликі фрагменти даних, які надсилаються веб-програмою, але зберігаються локально у браузері. Це дозволяє програмі використовувати файли cookie для передачі інформації між сторінками та зберігання змінної інформації. Веб-програма контролює, яка інформація зберігається в файлі cookie та як вона використовується. Типовими типами інформації, що зберігається в файлах cookie, є ідентифікатори сеансів, інформація про персоналізацію та налаштування, а в окремих випадках навіть імена користувачів для автоматичного входу. Існує два різних типи файлів cookie: сеансові та постійні файли cookie. Сеансові файли cookie просто живуть у пам’яті браузера й ніде не зберігаються, а постійні файли cookie зберігаються на жорсткому диску браузера. Це може спричинити проблеми з безпекою та конфіденційністю залежно від інформації, що зберігається в файлі cookie, і способу доступу до неї.

### Відносини
#### Релевантно перегляду "Концепції дослідження" (CWE-1000)
Ім'я ID типу природи
Файли або каталоги ChildOf Base 552, доступні зовнішнім сторонам

### Режими вступу

#### Примітка фази
Архітектура та дизайн

### Реалізація
- Загальні наслідки

#### Імовірність впливу масштабу

### Конфіденційність
Технічний вплив: читання даних програми

### Потенційні пом'якшення
Фаза: архітектура та дизайн

Не зберігайте конфіденційну інформацію в постійних файлах cookie.
